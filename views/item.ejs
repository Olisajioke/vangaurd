<%- include("partials/header") %>

<div class="container py-4">

  <div class="row g-4">

    <!-- IMAGE GALLERY -->
    <div class="col-lg-7">
      <% if (item.images && item.images.length > 0) { %>
        <div id="itemCarousel-<%= item.id %>" class="carousel slide item-gallery">

          <div class="carousel-inner rounded shadow-sm">
            <% item.images.forEach((img, index) => { %>
              <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                <img src="/uploads/<%= img %>" class="d-block w-100 gallery-image">
              </div>
            <% }) %>
          </div>

          <% if (item.images.length > 1) { %>
            <button class="carousel-control-prev" type="button"
                    data-bs-target="#itemCarousel-<%= item.id %>" data-bs-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </button>

            <button class="carousel-control-next" type="button"
                    data-bs-target="#itemCarousel-<%= item.id %>" data-bs-slide="next">
              <span class="carousel-control-next-icon"></span>
            </button>

            <div class="carousel-indicators position-static mt-3">
              <% item.images.forEach((img, index) => { %>
                <button type="button"
                        data-bs-target="#itemCarousel-<%= item.id %>"
                        data-bs-slide-to="<%= index %>"
                        class="<%= index === 0 ? 'active' : '' %>">
                </button>
              <% }) %>
            </div>
          <% } %>

        </div>
      <% } %>
    </div>

    <!-- DETAILS -->
    <div class="col-lg-5">

      <!-- TITLE + HEART -->
      <div class="d-flex justify-content-between align-items-start mb-3">
        <h2 class="fw-bold mb-0"><%= item.title %></h2>

        <form action="/toggle-save/<%= item.id %>" method="POST">
          <button class="btn btn-link fs-3 p-0 border-0">
            <% if (isSaved) { %>‚ù§Ô∏è<% } else { %>ü§ç<% } %>
          </button>
        </form>
      </div>

      <!-- PRICE -->
      <div class="item-price mb-3">
        ÿ±.ÿ≥ <%= item.price %>
      </div>

      <!-- INFO CARD -->
      <div class="item-info-card mb-4">

        <div class="info-row">
          <div class="info-label">Seller</div>
          <div class="info-value"><%= item.seller %></div>
        </div>

        <div class="info-row">
          <div class="info-label">Condition</div>
          <div class="info-value">
            <%= item.condition_note || "Not specified" %>
          </div>
        </div>

        <div class="info-row">
          <div class="info-label">Contact</div>
          <div class="info-value"><a href="https://wa.me/<%= String(item.contact).replace(/\D/g,'') %>"
                      target="_blank"
                      class="btn btn-success me-2">
                      <i class="fab fa-whatsapp me-1"></i>
                      WhatsApp
                  </a>
          </div>
        </div>


        <div class="info-row">
          <div class="info-label">Location</div>
          <div class="info-value"><%= item.location %></div>
        </div>

      </div>

      <!-- DESCRIPTION -->
      <% if (item.content) { %>
        <div class="item-description-block mb-4">
          <div class="section-title">Description</div>
          <div class="section-body">
            <%= item.content %>
          </div>
        </div>
      <% } %>

      <!-- ACTIONS -->
      <div class="d-flex gap-2 flex-wrap">
        <a href="/market" class="btn btn-outline-secondary">
          ‚Üê Back
        </a>

        <a href="/saved" class="btn btn-outline-dark">
          Saved Items
        </a>

        <% if (userId === item.user_id || isAdmin) { %>

          <button class="btn btn-outline-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#editItemModal-<%= item.id %>">
            <i class="fas fa-edit me-1"></i>
            Edit
          </button>

          <button class="btn btn-outline-danger"
                  data-bs-toggle="modal"
                  data-bs-target="#deleteItemModal-<%= item.id %>">
            <i class="fas fa-trash-alt me-1"></i>
            Delete
          </button>
          <% if (userId === item.user_id || isAdmin) { %>
            <%- include("partials/editItemModal", { item }) %>
            <%- include("partials/deleteItemModal", { item }) %>
          <% } %>
        <% } %>

      </div>


    </div>

  </div>

</div>
<%- include("partials/footer") %>
