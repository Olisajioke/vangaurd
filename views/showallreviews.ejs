<%- include("partials/header") %>

<!-- Hero Section -->
<section class="hero-reviews d-flex align-items-center justify-content-center text-center text-white"
  style="background:
         linear-gradient(rgba(0,0,0,.55),rgba(0,0,0,.55)),
         url('/images/article_osaf.png') center/cover no-repeat;">
  <div class="container">
    <h1 class="display-5 fw-bold">Clinic Reviews</h1>
    <p class="lead mb-4 text-white-75">
      Honest experiences from optometrists across the Kingdom
    </p>
    <a href="/reviews/create" class="btn btn-success btn-lg">
      Write a Review
    </a>
  </div>
</section>



<!-- Search Bar -->
<section class="clinic-search py-4 bg-light border-bottom">
  <div class="container">
    <form action="/reviews" method="GET" class="mx-auto" style="max-width:600px;">
      <div class="input-group input-group-lg shadow-sm">
        <input 
          type="text" 
          name="clinic"
          class="form-control border-0"
          placeholder="Search clinic name..."
          value="<%= typeof query !== 'undefined' ? query : '' %>"
        >
        <button class="btn btn-success px-4" type="submit">
          üîç Search
        </button>
      </div>
    </form>
  </div>
</section>


<div class="container my-5">
  <div class="row mb-2">

    <% if (!reviews || reviews.length === 0) { %>
      <div class="col-12 text-center py-5">
        <h4 class="text-muted mb-3">
          No clinic reviews found
          <% if (typeof query !== 'undefined' && query) { %>
            for "<%= query %>"
          <% } %>
        </h4>

        <a href="/reviews" class="btn btn-outline-success">
          View all reviews
        </a>
      </div>
    <% } %>

    <% reviews.forEach(r => { %>
      <div class="col-md-6">
        <div class="row g-0 border rounded overflow-hidden mb-4 shadow-sm h-100 position-relative">

          <!-- Text -->
          <div class="col p-4 d-flex flex-column">
            <strong class="d-inline-block mb-2 text-success-emphasis">
              Rating: ‚≠ê <%= r.rating %>
            </strong>

            <h3 class="mb-0"><%= r.clinic_name %></h3>

            <div class="mb-1 text-body-secondary">
              <%= r.created_at 
                    ? new Date(r.created_at).toLocaleDateString("en-GB") 
                    : "" %>
            </div>

            <p class="card-text mb-auto">            
              <%- r.recommendation
                    ? r.recommendation.replace(/<[^>]+>/g, "").substring(0,120) + "..."
                    : "No review text available." %>
            </p>

            <a href="/reviews/<%= r.post_id %>"
              class="icon-link gap-1 icon-link-hover stretched-link">
              Continue reading
            </a>
          </div>

          <!-- Image -->
          <div class="col-4 col-md-3 col-lg-4">
            <img src="<%= r.image_url || '/images/write.jpg' %>" 
                alt="Clinic image"
                class="img-fluid h-100 w-100"
                style="object-fit:cover;">
          </div>

        </div>
      </div>
    <% }) %>

  </div>
</div>


<%- include("partials/footer") %>
