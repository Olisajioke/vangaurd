<%- include("partials/header") %>

<!-- HERO -->
<section class="hero-stories d-flex align-items-center justify-content-center text-center text-white">
  <div class="hero-overlay"></div>
  <div class="container position-relative">
    <h1 class="display-5 fw-bold">Clinic Stories</h1>
    <p class="lead mb-4">Experiences, moments, and lessons from our clinics</p>
    <a class="btn btn-primary btn-lg" href="/new_clinic_stories">+ Add New Story</a>
  </div>
</section>


<!-- STORY SEARCH -->
<section class="clinic-search py-4 bg-light border-bottom">
  <div class="container">
    <div class="mx-auto" style="max-width:600px;">
      <div class="input-group input-group-lg shadow-sm">
        <input 
          type="text"
          id="storySearch"
          class="form-control border-0"
          placeholder="Search stories by title or clinic..."
        >
        <span class="input-group-text bg-success text-white">
          üîç
        </span>
      </div>
    </div>
  </div>
</section>


<main class="container my-5">
  <% if (posts && posts.length > 0) { %>
    <div class="row g-4">
      <% posts.forEach(function(post) { %>
        <div class="col-md-6 col-lg-4 story-card-wrap"
          data-title="<%= (post.title || '').toLowerCase() %>"
          data-subtitle="<%= (post.subtitle || '').toLowerCase() %>"
          data-author="<%= (post.fname || '').toLowerCase() %>">

          <div class="story-flip-card story-card">
            <div class="story-flip-card-inner">

              <!-- FRONT -->
              <div class="story-flip-card-front card shadow-sm">
                <div class="card-header fw-bold text-center">
                  <%= post.title %>
                </div>

                <div class="card-img-wrapper">
                  <img src="<%= post.image ? '/uploads/' + post.image : './images/write.jpg' %>" alt="story image">


                  
                  <div class="image-overlay">
                    <div class="overlay-text">
                      <div class="subtitle"><%= post.subtitle %></div>
                      <div class="author">by <%= post.fname %></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- BACK -->
              <div class="story-flip-card-back card text-white bg-dark">
                <div class="card-header fw-bold text-center">
                  Story Preview
                  <div style="color:red;font-size:12px">
                    <%= post.image1 %>
                  </div>
                </div>

                <div class="card-body d-flex flex-column justify-content-between">
                     <%= ((post.content || post.body || '').replace(/<[^>]*>/g, '').substring(0,140)) %>...
                    <hr>

                  <div class="text-center">
                    <a href="/view_posts/<%= post.id %>" class="btn btn-outline-light btn-sm">
                      Read Full Story
                    </a>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <div class="alert alert-info">
      <h4>No posts yet!</h4>
      <p>Create one <a href="/new_clinic_stories">here</a></p>
    </div>
  <% } %>
</main>




<script>
  const storyInput = document.getElementById("storySearch");
  const storyCards = document.querySelectorAll(".story-card-wrap");

  if (storyInput) {
    storyInput.addEventListener("input", function () {
      const q = this.value.toLowerCase().trim();

      storyCards.forEach(card => {
        const text =
          (card.dataset.title || "") +
          (card.dataset.subtitle || "") +
          (card.dataset.author || "");

        card.style.display = text.includes(q) ? "" : "none";
      });
    });
  }
</script>


<%- include("partials/footer") %>
