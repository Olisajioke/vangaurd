<%- include("partials/header") %>

<!-- HERO -->
<section class="hero-stories d-flex align-items-center justify-content-center text-center text-white">
  <div class="hero-overlay"></div>
  <div class="container position-relative">
    <h1 class="display-5 fw-bold">Clinic Stories</h1>
    <p class="lead mb-4">Experiences, moments, and lessons from our clinics</p>
    <a class="btn btn-primary btn-lg" href="/new_clinic_stories">+ Add New Story</a>
  </div>
</section>

<main class="container my-5">
  <% if (db.posts && db.posts.length > 0) { %>
    <div class="row g-4">
      <% db.posts.forEach(function(post) { %>
        <div class="col-md-6 col-lg-4">
          <div class="flip-card story-card">
            <div class="flip-card-inner">

              <!-- FRONT -->
              <div class="flip-card-front card shadow-sm">
                <div class="card-header fw-bold text-center">
                  <%= post.title %>
                </div>

                <div class="card-img-wrapper">
                  <img src="<%= post.image || '/images/default_story.jpg' %>" alt="story image">
                  
                  <div class="image-overlay">
                    <div class="overlay-text">
                      <div class="subtitle"><%= post.subtitle %></div>
                      <div class="author">by <%= post.author %></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- BACK -->
              <div class="flip-card-back card text-white bg-dark">
                <div class="card-header fw-bold text-center">
                  Story Preview
                </div>

                <div class="card-body d-flex flex-column justify-content-between">
                  <p class="mb-3">
                    <%= post.body.substring(0, 140) %>...
                  </p>

                  <div class="text-center">
                    <a href="/view_posts/<%= post.id %>" class="btn btn-outline-light btn-sm">
                      Read Full Story
                    </a>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <div class="alert alert-info">
      <h4>No posts yet!</h4>
      <p>Create one <a href="/new_clinic_stories">here</a></p>
    </div>
  <% } %>
</main>

<style>
/* HERO */
.hero-stories {
  height: 45vh;
  background: url('/images/forum.jpg') center/cover no-repeat;
  position: relative;
}

.hero-stories .hero-overlay {
  position: absolute;
  inset: 0;
  backdrop-filter: blur(6px);
  background: rgba(0,0,0,0.45);
}

/* CARD */
.story-card {
  height: 340px;
  perspective: 1000px;
}

.flip-card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transition: transform 0.6s;
  transform-style: preserve-3d;
}

.flip-card:hover .flip-card-inner {
  transform: rotateY(180deg);
}

.flip-card-front,
.flip-card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  backface-visibility: hidden;
  border-radius: 0.5rem;
  overflow: hidden;
}

/* FRONT IMAGE AREA */
.card-img-wrapper {
  position: relative;
  height: calc(100% - 48px); /* minus header */
}

.card-img-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* OVERLAY TEXT */
.image-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(0,0,0,.75), rgba(0,0,0,.15));
  display: flex;
  align-items: flex-end;
}

.overlay-text {
  padding: 1rem;
  color: white;
}

.overlay-text .subtitle {
  font-weight: 600;
  line-height: 1.2;
}

.overlay-text .author {
  font-size: 0.85rem;
  opacity: 0.9;
}

/* BACK */
.flip-card-back {
  transform: rotateY(180deg);
}

/* HOVER LIFT */
.story-card:hover {
  transform: translateY(-6px) scale(1.03);
}

/* HEADER STYLE BALANCE */
.flip-card-front .card-header {
  background: rgba(0,0,0,0.05);
}

.flip-card-back .card-header {
  background: rgba(255,255,255,0.08);
}
</style>

<%- include("partials/footer") %>
