<%- include("../partials/header") %>

<div class="container my-5 admin-vanguard-page">

  <div class="admin-vanguard-card mx-auto p-4">

    <h3 class="admin-vanguard-title">
      Vanguard Security Key
    </h3>

    <p class="admin-vanguard-subtext">
      This code controls access to the Vanguard Optometry Network.
      Changing it will affect all future registrations.
    </p>

    <div class="admin-vanguard-current">
      <label>Current Vanguard Code</label>
      <div class="admin-vanguard-code-display">
        <%= currentCode %>
      </div>
    </div>

    <button class="btn btn-dark admin-vanguard-edit-btn"
            data-bs-toggle="modal"
            data-bs-target="#vanguardModal">
      Edit / Regenerate
    </button>

  </div>

</div>


<!-- VANGUARD EDIT MODAL -->
<div class="modal fade" id="vanguardModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content admin-vanguard-modal">

      <div class="modal-header">
        <h5 class="modal-title">Update Vanguard Code</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form action="/admin/vanguard/update" method="POST">

        <div class="modal-body">

          <label class="admin-vanguard-label">
            Generated Secure Code
          </label>

          <div class="admin-vanguard-generator-row">
            <input type="text"
                   id="generatedCode"
                   class="form-control admin-vanguard-input"
                   readonly>

            <button type="button"
                    class="btn btn-outline-secondary"
                    onclick="generateVanguard()">
              Generate
            </button>
          </div>

          <label class="admin-vanguard-label mt-3">
            New Vanguard Code
          </label>

          <input type="text"
                 name="vanguard_code"
                 id="finalCode"
                 class="form-control admin-vanguard-input"
                 required>

          <small class="text-muted">
            Copy a generated code above or enter manually.
          </small>

        </div>

        <div class="modal-footer">
          <button type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal">
            Cancel
          </button>

          <button type="submit"
                  class="btn btn-dark">
            Save Code
          </button>
        </div>

      </form>

    </div>
  </div>
</div>
<script>
function generateVanguard() {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
  let code = "VNG-"

  for (let i = 0; i < 8; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length))
  }

  document.getElementById("generatedCode").value = code
  document.getElementById("finalCode").value = code
}
</script>

<%- include("../partials/footer") %>
