<%- include('partials/header') %>

<!-- HERO / JUMBOTRON -->

<div class="jumbotron text-center text-white position-relative overflow-hidden" style="padding:5rem 2rem;">

  <!-- Background image -->
  <div
    class="position-absolute w-100 h-100"
    style="
      top:0;
      left:0;
      background-image: url('<%= post.image1 ? "/uploads/" + post.image1 : "/images/default_bg.jpg" %>');
      background-size: cover;
      background-position: center;
      filter: blur(6px);
      transform: scale(1.1);
      z-index: 1;
    "
  ></div>

  <!-- Dark overlay -->
  <div
  class="position-absolute w-100 h-100 view-post-overlay"
  style="top:0; left:0; background: rgba(0,0,0,0.45); z-index:2;">
</div>


  <!-- Content -->
  <div class="position-relative" style="z-index:3;">
    <h1 class="display-4"><%= post.title %></h1>
      <p class="lead fw-semibold text-white-75"><%= post.subtitle %></p>
      <p class="mb-1 text-white">
        By <strong><%= post.fname %> <%= post.lname %></strong>
      </p>
      <p class="small text-white-50">
        <%= new Date(post.created_at).toLocaleDateString() %>
      </p>
  </div>
    

</div>

<!-- POST CONTENT -->
<div class="container mt-4">

  <!-- POST CARD -->
  <div class="card mb-4">
    <div class="card-body">
      <%- post.content %>
    </div>

    <% if (currentUserId === post.user_id || isAdmin) { %>
      <div class="card-footer">
          <a href="/new_clinic_stories?id=<%= post.id %>&mode=edit"
            class="btn btn-primary btn-light">
            <i class="fas fa-edit"></i>
            Edit Post
          </a>

          <button
            class="btn btn-danger ms-2"
            data-bs-toggle="modal"
            data-bs-target="#deletePostModal-<%= post.id %>">
            <i class="fas fa-trash-alt"></i> Delete
          </button>
      </div>
    <% } %>


    </div>
  </div>

  <!-- COMMENTS SECTION -->
<div class="card mt-4">
  <div class="card-header text-center">
    <h4 class="mb-0">Comments</h4>
  </div>

  <div class="card-body">

    <% if (comments && comments.length > 0) { %>
      <% comments.forEach(c => { %>

        <div class="comment mb-3 p-3 border rounded">
          <strong>Dr. <%= c.fname %></strong>

          <small class="text-muted d-block mb-1">
            <%= new Date(c.created_at).toLocaleDateString() %>
          </small>

          <p class="mb-2"><%= c.content %></p>
          <% if (currentUserId === c.user_id || isAdmin) { %>
            <div class="d-flex gap-2">
              <button
                class="btn btn-sm btn-outline-primary"
                data-bs-toggle="modal"
                data-bs-target="#editCommentModal-<%= c.id %>">
                Edit
              </button>

              <button
                class="btn btn-sm btn-danger"
                data-bs-toggle="modal"
                data-bs-target="#deleteCommentModal-<%= c.id %>">
                Delete
              </button>
            </div>
          <% } %>
      <% }) %>
    <% } else { %>
      <p class="text-center text-muted">
        No comments yet. Be the first to comment!
      </p>
    <% } %>

    <hr>

    <!-- ADD COMMENT -->
    <h5 class="text-center mb-3">Add a comment</h5>

    <form action="/posts/<%= post.id %>/comments" method="POST">
      <textarea
        name="comment"
        class="form-control mb-3"
        rows="3"
        placeholder="Write your comment..."
        required
      ></textarea>

      <button class="btn btn-primary w-100">
        Submit Comment
      </button>
    </form>

  </div>
</div>

<%- include('partials/deletePostModal', { post }) %>
<%- include('partials/editarticlecommentModal', { comments, post }) %>
<%- include('partials/deletearticlecommentModal', { comments, post }) %>

<%- include('partials/footer') %>