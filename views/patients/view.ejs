<%- include("../partials/header") %>

<!--div class="container py-4" style="max-width:950px;"-->
<div class="container-fluid py-4 px-3 px-xl-5">

  <!-- PATIENT HEADER -->
  <div class="card border-0 shadow-sm mb-4 p-3 bg-light-subtle">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">

      <div>
        <h3 class="fw-bold text-success mb-1">
          <%= patient.first_name %> <%= patient.last_name %>
        </h3>

        <div class="text-muted small">
          <%= patient.gender || "—" %>
          <% if (patient.age) { %> • <%= patient.age %> yrs <% } %>
        </div>
      </div>

      <div class="d-flex gap-2">
        <a href="/patients/<%= patient.patient_id %>/edit"
           class="btn btn-sm btn-outline-primary">
          Edit
        </a>

        <button class="btn btn-sm btn-outline-danger"
                data-bs-toggle="modal"
                data-bs-target="#deletePatientModal">
          Delete
        </button>
      </div>

    </div>
  </div>

  <!-- SYSTEMIC -->
  <div class="card border-0 shadow-sm mb-3 p-3">
    <div class="fw-semibold text-secondary mb-2">
      Systemic & Surgical History
    </div>

    <div class="small text-muted">
      <div><strong>Systemic:</strong> <%= patient.systemic_condition || "—" %></div>
      <div><strong>Surgeries:</strong> <%= patient.ocular_surgery || "—" %></div>
    </div>
  </div>

  <!-- VISUAL ACUITY -->
  <div class="card border-0 shadow-sm mb-3 p-3">
    <div class="fw-semibold text-center mb-3">
      Visual Acuity
    </div>

    <div class="row text-center fw-semibold text-secondary small mb-2">
      <div class="col-4"></div>
      <div class="col-4">OD</div>
      <div class="col-4">OS</div>
    </div>

    <div class="row text-center mb-1">
      <div class="col-4 fw-semibold">VA</div>
      <div class="col-4"><%= patient.va_od || "—" %></div>
      <div class="col-4"><%= patient.va_os || "—" %></div>
    </div>

    <div class="row text-center">
      <div class="col-4 fw-semibold">PH</div>
      <div class="col-4"><%= patient.ph_od || "—" %></div>
      <div class="col-4"><%= patient.ph_os || "—" %></div>
    </div>
  </div>

  <!-- SUBJECTIVE REFRACTION -->
  <div class="card border-0 shadow-sm mb-3 p-3">
    <div class="fw-semibold text-center mb-3">
      Subjective Refraction
    </div>

    <div class="row text-center fw-semibold text-secondary small mb-2">
      <div class="col-4"></div>
      <div class="col-4">OD</div>
      <div class="col-4">OS</div>
    </div>

    <div class="row text-center mb-1">
      <div class="col-4 fw-semibold">Sphere</div>
      <div class="col-4"><%= patient.sph_od_sub ?? "—" %></div>
      <div class="col-4"><%= patient.sph_os_sub ?? "—" %></div>
    </div>

    <div class="row text-center mb-1">
      <div class="col-4 fw-semibold">Cylinder</div>
      <div class="col-4"><%= patient.cyl_od_sub ?? "—" %></div>
      <div class="col-4"><%= patient.cyl_os_sub ?? "—" %></div>
    </div>

    <div class="row text-center mb-1">
      <div class="col-4 fw-semibold">Axis</div>
      <div class="col-4"><%= patient.axis_od_sub ?? "—" %></div>
      <div class="col-4"><%= patient.axis_os_sub ?? "—" %></div>
    </div>

    <div class="row text-center mb-1">
      <div class="col-4 fw-semibold">VA</div>
      <div class="col-4"><%= patient.va_od_sub || "—" %></div>
      <div class="col-4"><%= patient.va_os_sub || "—" %></div>
    </div>

    <div class="row text-center">
      <div class="col-4 fw-semibold">ADD</div>
      <div class="col-4"><%= patient.add_od ?? "—" %></div>
      <div class="col-4"><%= patient.add_os ?? "—" %></div>
    </div>
  </div>

  <!-- DIAGNOSIS -->
  <div class="card border-0 shadow-sm mb-3 p-3">
    <div class="fw-semibold text-secondary mb-2">
      Diagnosis
    </div>

    <div>
      <% if (patient.diagnosis) { %>
        <span class="badge bg-success-subtle text-success fw-semibold">
          <%= patient.diagnosis %>
        </span>
      <% } else { %>
        <span class="text-muted">—</span>
      <% } %>
    </div>
  </div>

  <!-- CLINICAL NOTES -->
  <div class="card border-0 shadow-sm p-3">
    <div class="fw-semibold text-secondary mb-2">
      Clinical Notes
    </div>

    <div class="small text-muted">
      <%= patient.current_health_status || "—" %>

      <% if (patient.notes) { %>
        <hr class="my-2">
        <%= patient.notes %>
      <% } %>
    </div>
  </div>

</div>

<!-- DELETE MODAL -->
<div class="modal fade" id="deletePatientModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4 border-0 shadow">

      <div class="mb-3">
        <i class="fas fa-exclamation-triangle text-danger fa-2x"></i>
      </div>

      <h5 class="mb-2">Delete patient record?</h5>

      <div class="text-muted small mb-4">
        This action cannot be undone
      </div>

      <form action="/patients/<%= patient.patient_id %>/delete"
            method="POST">

        <button class="btn btn-danger px-4 me-2">
          Yes, Delete
        </button>

        <button type="button"
                class="btn btn-light border"
                data-bs-dismiss="modal">
          Cancel
        </button>

      </form>
    </div>
  </div>
</div>

<%- include("../partials/footer") %>