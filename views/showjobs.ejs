<%- include("partials/header") %>

<!-- Jobs Hero -->
<section class="hero-jobs d-flex align-items-center justify-content-center text-center text-white" style="background:
       linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
       url('./images/job_logo.jpg') center/cover no-repeat;">
  <div class="container">
    <h1 class="display-5 fw-bold">Job Vacancies</h1>
    <p class="lead mb-4 text-white-75">Opportunities across trusted clinics</p>
    <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#createJobModal">
      + Post Job
    </button>
  </div>
</section>

<!-- SEARCH BAR -->
<section class="clinic-search py-4 bg-light border-bottom">
  <div class="container">
    <form action="/showjobs" method="GET" class="mx-auto" style="max-width:600px;">
      <div class="input-group input-group-lg shadow-sm">
        <input 
          type="text" 
          name="clinic"
          class="form-control border-0"
          placeholder="Search job by Salary, Location, title or name..."
          value="<%= typeof query !== 'undefined' ? query : '' %>"
        >
        <button class="btn btn-success px-4" type="submit">
          üîç Search
        </button>
      </div>
    </form>
  </div>
</section>

<section class="jobs-listing py-5">
  <div class="container">

    <% if (!jobs || jobs.length === 0) { %>
      <div class="text-center text-muted py-5">
        <h5 class="mb-3">No jobs available</h5>
        <button class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#createJobModal">
          Post the first job
        </button>
      </div>
    <% } %>

    <div class="row g-4">

      <% jobs.forEach(job => { %>
        <div class="col-12 col-md-6 col-lg-4 job-card"
            data-clinic="<%= (job.clinic || '').toLowerCase() %>"
            data-title="<%= (job.title || '').toLowerCase() %>"
            data-location="<%= (job.location || '').toLowerCase() %>"
            data-salary="<%= (job.salary || '').toString().toLowerCase() %>">

          <div class="job-flip-card">
            <div class="job-flip-card-inner">

              <!-- FRONT -->
              <div class="job-flip-card-front card shadow-sm job-front">
                <div class="job-front-header">
                  <h5 class="job-title mb-0"><%= job.title %></h5>
                  <span class="job-badge">Wanted</span>
                </div>

                <div class="card-body">
                  <p class="job-clinic mb-2">
                    <i class="fas fa-clinic-medical me-2"></i>
                    <%= job.clinic %>
                  </p>

                  <p class="job-location mb-3">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    <%= job.location %>
                  </p>

                  <div class="job-salary-front">
                    <small class="text-muted">Salary</small><br>
                    ÿ±.ÿ≥ <%= job.salary %>
                  </div>
                </div>
              </div>

              <!-- BACK -->
              <div class="job-flip-card-back card text-white bg-dark">
                <div class="card-header fw-bold text-center">
                  Job Details
                </div>

                  <div class="card-body">
                    <div class="job-text">
                      <p class="mb-2">
                        <%= job.description && job.description.length > 200
                              ? job.description.substring(0, 200) + "..."
                              : job.description %>
                      </p>

                      <p class="mb-0"><strong>Contact:</strong> <%= job.contact %></p>
                    </div>

                    <hr>

                    <div class="text-center mt-2">

                    <a href="/jobs/<%= job.id %>" class="btn btn-success btn-sm me-2">
                      View
                    </a>
                    <% if (currentUserId === job.user_id || isAdmin) { %>
                      <button class="btn btn-outline-light btn-sm me-2"
                              data-bs-toggle="modal"
                              data-bs-target="#editJobModal-<%= job.id %>">
                        Edit
                      </button>

                      <button class="btn btn-danger btn-sm"
                              data-bs-toggle="modal"
                              data-bs-target="#deleteJobModal-<%= job.id %>">
                        Delete
                      </button>
                    <% } %>
                  </div>
                </div>
              </div>

            </div>
          </div>

        </div>

        <%- include("partials/editJobModal", { job }) %>
        <%- include("partials/deleteJobModal", { job }) %>

      <% }) %>

    </div>
  </div>
</section>


<%- include("partials/createJobModal") %>








<script>
  const searchInput = document.querySelector('input[name="clinic"]');
  const jobCards = document.querySelectorAll('.job-card');

  if (searchInput) {
    searchInput.addEventListener('input', function () {
      const value = this.value.toLowerCase().trim();

      jobCards.forEach(card => {
        const clinic = card.dataset.clinic || "";
        const title = card.dataset.title || "";
        const location = card.dataset.location || "";
        const salary = card.dataset.salary || "";

        const searchableText = clinic + " " + title + " " + location + " " + salary;

        if (searchableText.includes(value)) {
          card.style.display = "";
        } else {
          card.style.display = "none";
        }
      });
    });
  }
</script>


<%- include("partials/footer") %>
