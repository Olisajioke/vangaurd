<%- include("partials/header") %>

<div class="container py-4" style="max-width:1200px;">

  <div class="row g-4">

    <!-- SIDEBAR -->
    <div class="col-lg-3">

      <div class="card border-0 shadow-sm text-center p-4">

        <img src="/uploads/<%= user.profilepic || 'default.png' %>"
             class="rounded-circle mb-3 mx-auto"
             style="width:110px;height:110px;object-fit:cover;">

        <h5 class="fw-semibold mb-0">
          <%= user.fname %> <%= user.lname %>
        </h5>

        <div class="text-muted small mb-2">
          <%= user.role || "Optometrist" %>
        </div>

        <div class="text-muted small mb-3">
          <i class="fas fa-map-marker-alt me-1"></i>
          <%= user.location || "â€”" %>
        </div>

        <hr class="my-3">

        <!-- NAV -->
      <div class="list-group list-group-flush text-start">
          <!-- NAV -->
        <div class="profile-nav">

          <a href="/profile" class="profile-card">
            <i class="fas fa-user"></i>
            <span>Overview</span>
          </a>

          <a href="/patients" class="profile-card">
            <i class="fas fa-users"></i>
            <span>Patient Records</span>
          </a>

          <a href="/relationships" class="profile-card">
            <i class="fas fa-network-wired"></i>
            <span>Relationships</span>
          </a>

          <a href="/reviews" class="profile-card">
            <i class="fas fa-star"></i>
            <span>Reviews</span>
          </a>

          <a href="/market" class="profile-card">
            <i class="fas fa-box"></i>
            <span>My Items</span>
          </a>

          <a href="/articles" class="profile-card">
            <i class="fas fa-newspaper"></i>
            <span>Articles</span>
          </a>

          <a href="/showjobs" class="profile-card">
            <i class="fas fa-briefcase"></i>
            <span>Jobs</span>
          </a>

          <a href="/saved" class="profile-card">
            <i class="fas fa-bookmark"></i>
            <span>Saved</span>
          </a>

        </div>


        </div>

        <hr class="my-3">

        <button class="btn btn-outline-primary w-100 mb-2"
                data-bs-toggle="modal"
                data-bs-target="#editUserModal-<%= user.id %>">
          Edit Profile
        </button>

        <button class="btn btn-outline-danger w-100 mb-3"
                data-bs-toggle="modal"
                data-bs-target="#deleteUserModal-<%= user.id %>">
          Delete Account
        </button>

        <form action="/logout" method="POST">
          <button class="btn btn-dark w-100">
            Logout
          </button>
        </form>

      </div>

    </div>

    <!-- CONTENT -->
    <div class="col-lg-9">

      <!-- STATS -->
      <div class="row g-3 mb-4">
        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div class="card border-0 shadow-sm text-center p-3">
              <div class="fs-4 fw-bold text-success">
                <%= stats.patients %>
              </div>
              <div class="small text-muted">Patients</div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card border-0 shadow-sm text-center p-3">
              <div class="fs-4 fw-bold text-success">
                <%= stats.posts %>
              </div>
              <div class="small text-muted">Posts</div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card border-0 shadow-sm text-center p-3">
              <div class="fs-4 fw-bold text-success">
                <%= stats.relationships %>
              </div>
              <div class="small text-muted">Relationships</div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card border-0 shadow-sm text-center p-3">
              <div class="fs-4 fw-bold text-success">
                <%= stats.articles %>
              </div>
              <div class="small text-muted">Articles</div>
            </div>
          </div>
        </div>
      </div>

      <!-- WELCOME -->
      <div class="card border-0 shadow-sm p-4">
        <h4 class="display-6 fw-bold mb-2">
          Welcome back, Dr. <%= user.fname %>
        </h4>

        <div class="text-muted">
          This is your professional dashboard. Access your patients,
          content, and activity from the left panel or the buttons above.
        </div>
        <!-- NOTICE BOARD -->
        <div class="notice-board mt-4">
          <div class=" text-right display-7 fw-bold notice-board__title">
            <i class="bi bi-megaphone"></i>
            Important Notices
          </div>
          <% if (activeNotices && activeNotices.length > 0) { %>
            <% activeNotices.forEach(n => { %>
              <div class="notice-board__item">
                <div class="notice-board__item-title">
                  <%= n.title %>
                </div>
                <div class="notice-board__item-text">
                  <%= n.message %>
                </div>
              </div>
              <% if (user.role === 'admin') { %>
                <div class="btn notice-board__actions">
                  <a href="/admin/notices/<%= n.id %>/edit">Edit</a>
                </div>
              <% } %>
            </div>
            <% }) %>

          <% } else { %>

            <div class="notice-board__empty">
              No new notices for now
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .notice-board {
  border-top: 1px solid #eee;
  padding-top: 1rem;
}

.notice-board__title {
  font-weight: 600;
  color: #dc3545;
  margin-bottom: .6rem;
  display: flex;
  align-items: center;
  gap: .4rem;
}

.notice-board__actions {
  margin-top: .3rem;
}

.notice-board__actions a {
  font-size: .75rem;
  color: #842029;
  text-decoration: underline;
}


.notice-board__item {
  background: #fff5f5;
  border: 1px solid #f5c2c7;
  border-left: 4px solid #dc3545;
  padding: .7rem .9rem;
  border-radius: .5rem;
  margin-bottom: .5rem;
}

.notice-board__item-title {
  font-weight: 600;
  color: #842029;
  font-size: .92rem;
}

.notice-board__item-text {
  color: #842029;
  font-size: .88rem;
}

.notice-board__empty {
  color: #6c757d;
  font-size: .9rem;
}
.notice-modal {
  border-top: 4px solid #dc3545;
}

.notice-modal .modal-title {
  color: #dc3545;
  font-weight: 600;
}

</style>
<% if (popupNotice) { %>
<div class="modal fade" id="noticeModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content notice-modal">

      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-megaphone"></i>
          <%= popupNotice.title %>
        </h5>

        <button type="button"
                class="btn-close"
                data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <%= popupNotice.message %>
      </div>

    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const modal = new bootstrap.Modal(
    document.getElementById("noticeModal")
  );
  modal.show();
});
</script>

<% } %>

<%- include("partials/editUserModal", { user }) %>
<%- include("partials/deleteUserModal", { user }) %>
<%- include("partials/footer") %>
